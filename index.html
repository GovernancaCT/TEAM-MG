<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz da Reuni√£o</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      text-align: center;
    }
    .hidden { display: none; }
    .screen { padding: 40px; }

    input {
      padding: 10px;
      width: 260px;
      border-radius: 6px;
      border: 1px solid #aaa;
      font-size: 16px;
    }
    button {
      padding: 12px 20px;
      background: #FF5722;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      color: #fff;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover { opacity: .9; }

    .opcao {
      padding: 12px;
      margin: 10px auto;
      background: #fff;
      border: 2px solid #FF5722;
      width: 80%;
      border-radius: 8px;
      cursor: pointer;
    }

    .timer {
      margin-top: 20px;
      font-weight: bold;
      font-size: 20px;
    }

    table {
      margin: 20px auto;
      width: 90%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background: #FF5722;
      color: white;
    }

    #podioContainer {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    .podium {
      width: 120px;
      border-radius: 12px 12px 0 0;
      background: #FF9800;
      color: #fff;
      padding: 10px 5px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
      opacity: 0;
      transform: translateY(40px);
      animation: subir 0.8s ease-out forwards;
    }
    .podium-1 {
      height: 220px;
      background: #FFC107;
      animation-delay: .2s;
    }
    .podium-2 {
      height: 170px;
      background: #FF9800;
      animation-delay: 0s;
    }
    .podium-3 {
      height: 150px;
      background: #FFB74D;
      animation-delay: .4s;
    }
    .podium-pos {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .podium-name {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .podium-points {
      font-size: 12px;
      opacity: .9;
    }

    @keyframes subir {
      from { opacity: 0; transform: translateY(40px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .playerItem {
      margin: 10px auto;
      padding: 10px;
      width: 300px;
      box-shadow: 0 0 6px rgba(0,0,0,0.15);
      border-radius: 8px;
      background: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>

  <!-- TELA QR -->
  <div id="qrScreen" class="screen">
    <h1>üîí Acesso Restrito</h1>
    <p>Escaneie o QR Code para participar</p>
    <img src="SEU_QRCODE.png" width="200">
    <button onclick="acessarComQR()">J√° escaneei</button>
  </div>

  <!-- CADASTRO -->
  <div id="cadastroScreen" class="screen hidden">
    <h2>Digite seu nome para entrar</h2>
    <input id="nomeJogador" placeholder="Seu nome">
    <button onclick="entrar()">Entrar</button>
  </div>

  <!-- LOBBY -->
  <div id="posCadastroScreen" class="screen hidden">
    <h1>üë• Participantes Conectados</h1>
    <h2 id="contadorPessoas">0 jogadores</h2>
    <button onclick="irParaEspera()">Continuar</button>
  </div>

  <!-- ESPERA -->
  <div id="waitingScreen" class="screen hidden">
    <h2>Aguarde o anfitri√£o iniciar‚Ä¶</h2>
  </div>

  <!-- ADMIN -->
  <div id="adminScreen" class="screen hidden">
    <h1>Painel do Anfitri√£o</h1>
    <p id="infoAdmin"></p>
    <button onclick="iniciarPerguntaAdmin()">‚ñ∂ Iniciar Pr√≥xima Pergunta</button>
    <button onclick="abrirGerenciarJogadores()">üë• Participantes</button>
    <br><br>
    <button style="background:#d60000" onclick="resetTotal()">üóëÔ∏è RESET TOTAL</button>
  </div>

  <!-- GERENCIAR JOGADORES -->
  <div id="gerenciarJogadoresScreen" class="screen hidden">
    <h1>üë• Gerenciar Jogadores</h1>
    <div id="listaJogadoresAdmin"></div>
    <button onclick="voltarAdmin()">‚¨Ö Voltar</button>
  </div>

  <!-- PERGUNTA -->
  <div id="quizScreen" class="screen hidden">
    <h2 id="perguntaTexto"></h2>
    <div id="opcoes"></div>

    <div class="timer">‚è≥ Tempo: <span id="tempo">15</span>s</div>

    <!-- BOT√ÉO AUTOM√ÅTICO PARA ADMIN QUANDO TEMPO ZERA -->
    <button id="botaoProximaAdmin" class="hidden" onclick="iniciarPerguntaAdmin()">
      ‚û° Pr√≥xima Pergunta
    </button>
  </div>

  <!-- RANKING PARCIAL -->
  <div id="rankingScreen" class="screen hidden">
    <h2>Ranking Parcial</h2>
    <p id="tempoDaPergunta"></p>
    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Pontos</th>
          <th>Tempo</th>
        </tr>
      </thead>
      <tbody id="rankingTabela"></tbody>
    </table>
    <button onclick="adminDecide()">Continuar</button>
  </div>

  <!-- FINAL -->
  <div id="resultadoScreen" class="screen hidden">
    <h1>üèÜ Resultado Final</h1>
    <div id="podioContainer">
      <div class="podium podium-2">
        <div class="podium-pos">ü•à</div>
        <div class="podium-name" id="podio2Nome">---</div>
        <div class="podium-points" id="podio2Pontos"></div>
      </div>
      <div class="podium podium-1">
        <div class="podium-pos">ü•á</div>
        <div class="podium-name" id="podio1Nome">---</div>
        <div class="podium-points" id="podio1Pontos"></div>
      </div>
      <div class="podium podium-3">
        <div class="podium-pos">ü•â</div>
        <div class="podium-name" id="podio3Nome">---</div>
        <div class="podium-points" id="podio3Pontos"></div>
      </div>
    </div>

    <div id="rankingAdmin" class="hidden">
      <h2>Ranking Completo</h2>
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Pontos</th>
            <th>Tempo</th>
          </tr>
        </thead>
        <tbody id="rankingAdminTabela"></tbody>
      </table>
    </div>
  </div>

<script>
/* =====================================================
   CONFIG
===================================================== */
const SCRIPT_URL = "https://bitter-dew-fe17.henrique-teixeira.workers.dev/";

const perguntas = [
  { pergunta: "Quem √© respons√°vel pela √°rea de Control Tower BR?", opcoes: ["Julia Granato","Leticia alves","Joareis Souza","Lilian Arag√£o"], correta:0 },
  { pergunta: "Em qual frente o time do Saulo atua?", opcoes: ["D+1","D0","Efici√™cia Operacional","Performance de monitoramento"], correta:1 },
  { pergunta: "Quantos HUBs tem a Regional de MG?", opcoes: ["22","24","26","28"], correta:0 },
  { pergunta: "Qual a m√©dia de HUBs que um monitor acompanha?", opcoes: ["3","4","1","6"], correta:1 },
  { pergunta: "Quantas rotas em m√©dia o monitor trata por dia?", opcoes: ["400","200","100","600"], correta:0 },
  { pergunta: "Qual Sub-regional teve o melhor DS D0?", opcoes: ["MG-02","MG-04","MG-03","MG-01"], correta:3 },
  { pergunta: "Qual HUB teve o melhor DS D0?", opcoes: ["LMG-05","LMG-20","LMG-13","LMG-62"], correta:2 },
  { pergunta: "Qual foi o m√™s com melhor DS D0?", opcoes: ["Fevereiro","Abril","Junho","Agosto"], correta:0 },
  { pergunta: "Quem o motorista deve acionar quando estiver em rota?", opcoes: ["Analista transportes","Monitoramento","Supervisor de transportes","Saulo"], correta:1 },
  { pergunta: "Qual √© a √°rea respons√°vel pela gest√£o do motorista?", opcoes: ["Monitoramento","Fleet","HUB","Planejamento"], correta:1 }
];

let nomeAtual = "";
let isAdmin = false;
let pontos = 0;
let tempoTotal = 0;

let indexPergunta = 0;
let ultimaPerguntaVista = 0;
let tempo = 15;
let timer = null;
let tempoInicioPergunta = 0;
let jogoFinalizado = false;


/* =====================================================
   HELPERS
===================================================== */
function show(id) { document.getElementById(id).classList.remove("hidden"); }
function hide(id) { document.getElementById(id).classList.add("hidden"); }

async function getEstado() {
  const resp = await fetch(SCRIPT_URL);
  return resp.json();
}

async function postEstado(obj) {
  await fetch(SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(obj)
  });
}


/* =====================================================
   FLUXO INICIAL
===================================================== */
function acessarComQR() {
  hide("qrScreen");
  show("cadastroScreen");

  let salvo = localStorage.getItem("quizNome");
  if (salvo) document.getElementById("nomeJogador").value = salvo;
}

async function entrar() {
  nomeAtual = document.getElementById("nomeJogador").value.trim();
  if (!nomeAtual) return alert("Digite o nome!");

  isAdmin = nomeAtual.toLowerCase() === "henriquectx";

  pontos = 0;
  tempoTotal = 0;
  ultimaPerguntaVista = 0;

  localStorage.setItem("quizNome", nomeAtual);

  await postEstado({ addPlayer: nomeAtual });

  hide("cadastroScreen");
  show("posCadastroScreen");
}

function irParaEspera() {
  hide("posCadastroScreen");
  if (isAdmin) show("adminScreen");
  else show("waitingScreen");
}


/* =====================================================
   ADMIN ‚Äì RESET
===================================================== */
async function resetTotal() {
  if (!isAdmin) return;

  if (!confirm("Tem certeza que deseja apagar TUDO?")) return;

  await postEstado({ resetAll: true });

  pontos = 0;
  tempoTotal = 0;
  indexPergunta = 0;
  ultimaPerguntaVista = 0;
  jogoFinalizado = false;

  alert("Sistema resetado!");

  hide("resultadoScreen");
  hide("quizScreen");
  hide("waitingScreen");
  hide("adminScreen");

  show("cadastroScreen");
}

/* =====================================================
   ADMIN ‚Äì INICIAR PERGUNTA
===================================================== */
async function iniciarPerguntaAdmin() {

  const btnAdmin = document.getElementById("botaoProximaAdmin");
  btnAdmin.classList.add("hidden"); // some bot√£o ao avan√ßar

  const est = await getEstado();
  const atual = Number(est.pergunta_atual || 0);
  const prox = atual + 1;

  if (prox > perguntas.length) {
    await postEstado({ pergunta_atual: 0, status: "finalizado" });
    finalizarGeral();
    return;
  }

  indexPergunta = prox - 1;
  ultimaPerguntaVista = prox;

  await postEstado({ pergunta_atual: prox, status: "respondendo" });

  exibirPerguntaAtual();
}


/* =====================================================
   ADMIN ‚Äì LISTAR JOGADORES
===================================================== */
async function abrirGerenciarJogadores() {
  hide("adminScreen");
  show("gerenciarJogadoresScreen");

  const est = await getEstado();
  const players = est.players || [];

  let html = "";
  players.forEach(p => {
    html += `
      <div class="playerItem">
        <span>${p}</span>
        <button style="background:#d60000" onclick="removerJogador('${p}')">Remover</button>
      </div>
    `;
  });

  document.getElementById("listaJogadoresAdmin").innerHTML = html;
}

async function removerJogador(nome) {
  if (!confirm("Deseja remover " + nome + "?")) return;
  await postEstado({ removePlayer: nome });
  abrirGerenciarJogadores();
}

function voltarAdmin() {
  hide("gerenciarJogadoresScreen");
  show("adminScreen");
}


/* =====================================================
   EXIBIR PERGUNTA
===================================================== */
function exibirPerguntaAtual() {

  document.getElementById("botaoProximaAdmin").classList.add("hidden");

  hide("waitingScreen");
  hide("adminScreen");
  hide("rankingScreen");
  show("quizScreen");

  const q = perguntas[indexPergunta];
  document.getElementById("perguntaTexto").innerText = q.pergunta;

  let html = "";
  if (!isAdmin) {
    q.opcoes.forEach((opc, i) => {
      html += `<div class="opcao" onclick="responder(${i})">${opc}</div>`;
    });
  } else {
    html = "<p>Voc√™ √© admin. Apenas observando o tempo.</p>";
  }

  document.getElementById("opcoes").innerHTML = html;

  tempo = 15;
  tempoInicioPergunta = Date.now();
  document.getElementById("tempo").innerText = tempo;

  clearInterval(timer);

  timer = setInterval(() => {
    tempo--;
    if (tempo < 0) tempo = 0;

    document.getElementById("tempo").innerText = tempo;

    if (tempo <= 0) {
      clearInterval(timer);

      if (!isAdmin) {
        registrarResposta(false);
      } else {
        document.getElementById("botaoProximaAdmin").classList.remove("hidden");
      }
    }
  }, 1000);
}


/* =====================================================
   RESPONDER
===================================================== */
function responder(opcao) {
  if (isAdmin) return;
  clearInterval(timer);
  const acertou = (opcao === perguntas[indexPergunta].correta);
  registrarResposta(acertou);
}

async function registrarResposta(acertou) {
  const tempoGasto = (Date.now() - tempoInicioPergunta) / 1000;

  if (acertou) pontos++;
  tempoTotal += tempoGasto;

  await postEstado({
    addRanking: {
      nome: nomeAtual,
      pontos,
      tempoTotal
    }
  });

  mostrarRanking(tempoGasto);
}


/* =====================================================
   RANKING PARCIAL
===================================================== */
async function mostrarRanking(tempoGasto) {
  hide("quizScreen");
  show("rankingScreen");

  document.getElementById("tempoDaPergunta").innerText =
    `Voc√™ gastou: ${tempoGasto.toFixed(2)}s`;

  const est = await getEstado();

  let html = "";
  (est.ranking || []).forEach(r => {
    html += `
      <tr>
        <td>${r.nome}</td>
        <td>${r.pontos}</td>
        <td>${r.tempoTotal.toFixed(2)}</td>
      </tr>
    `;
  });

  document.getElementById("rankingTabela").innerHTML = html;
}

function adminDecide() {
  hide("rankingScreen");
  if (isAdmin) show("adminScreen");
  else show("waitingScreen");
}


/* =====================================================
   FINALIZAR
===================================================== */
async function finalizarGeral() {
  if (jogoFinalizado) return;
  jogoFinalizado = true;

  hide("rankingScreen");
  hide("quizScreen");
  hide("adminScreen");
  hide("waitingScreen");

  show("resultadoScreen");

  const est = await getEstado();
  const top3 = est.top3 || [];
  const ranking = est.ranking || [];

  function fill(pos, data) {
    document.getElementById(`podio${pos}Nome`).innerText = data ? data.nome : "---";
    document.getElementById(`podio${pos}Pontos`).innerText =
      data ? `${data.pontos} pts ‚Ä¢ ${data.tempoTotal.toFixed(2)}s` : "";
  }

  fill(1, top3[0]);
  fill(2, top3[1]);
  fill(3, top3[2]);

  if (isAdmin) {
    show("rankingAdmin");
    let html = "";
    ranking.forEach(r => {
      html += `
        <tr>
          <td>${r.nome}</td>
          <td>${r.pontos}</td>
          <td>${r.tempoTotal.toFixed(2)}</td>
        </tr>`;
    });
    document.getElementById("rankingAdminTabela").innerHTML = html;
  }
}


/* =====================================================
   LOOP - ATUALIZA√á√ÉO GLOBAL
===================================================== */
async function buscarEstadoServidor() {
  const est = await getEstado();
  const perguntaAtual = Number(est.pergunta_atual || 0);
  const status = est.status;

  document.getElementById("contadorPessoas").innerText =
    `${est.total_jogadores} jogadores`;

  if (isAdmin) {
    document.getElementById("infoAdmin").innerText =
      `Pergunta atual: ${perguntaAtual}/${perguntas.length} | Status: ${status}`;
  }

  if (!isAdmin) {
    if (perguntaAtual > 0 && perguntaAtual !== ultimaPerguntaVista) {
      ultimaPerguntaVista = perguntaAtual;
      indexPergunta = perguntaAtual - 1;
      exibirPerguntaAtual();
    }

    if (status === "finalizado" && !jogoFinalizado) {
      finalizarGeral();
    }
  }
}

setInterval(buscarEstadoServidor, 1500);

</script>

</body>
</html>




