<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Quiz MG - VersÃ£o Final</title>
<style>
  body { font-family: Arial; margin: 0; background: #111; color: #fff; }
  .tela { display: none; padding: 20px; }
  button { padding: 12px 20px; font-size: 18px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  td, th { border: 1px solid #444; padding: 10px; text-align: left; }
  .hidden { display: none !important; }
  #podium div { margin: 10px 0; font-size: 22px; }
</style>
</head>
<body>

<!-- ========================= CADASTRO ========================== -->
<div id="cadastroScreen" class="tela" style="display:block">
  <h1>Bem-vindo ao Quiz MG</h1>

  <input type="text" id="nomeInput" placeholder="Seu nome" style="padding:10px;font-size:18px">
  <br><br>

  <label><input type="checkbox" id="adminCheck"> Sou administrador</label>
  <br><br>

  <button onclick="entrar()">Entrar</button>
</div>

<!-- ========================= TELA DE ESPERA ========================== -->
<div id="waitingScreen" class="tela">
  <h2>Aguarde o inÃ­cioâ€¦</h2>
  <h3 id="contadorPessoas" class="hidden">0 jogadores</h3>
</div>

<!-- ========================= ADMIN ========================== -->
<div id="adminScreen" class="tela">
  <h1>Painel do Administrador</h1>

  <h3>Status: <span id="statusAdmin"></span></h3>
  <h3>Pergunta atual: <span id="perguntaAtualAdmin"></span></h3>
  <h3>Total de jogadores: <span id="totalJogadoresAdmin"></span></h3>

  <button onclick="iniciarQuiz()">â–¶ Iniciar</button>
  <button onclick="proxPergunta()">âž¡ PrÃ³xima Pergunta</button>
  <button style="background:#d30000" onclick="resetTotal()">ðŸ—‘ Reset Total</button>
</div>

<!-- ========================= QUIZ ========================== -->
<div id="quizScreen" class="tela">
  <h1 id="textoPergunta"></h1>
  <div id="opcoes"></div>
</div>

<!-- ========================= RANKING ADMIN ========================== -->
<div id="rankingAdmin" class="tela hidden">
  <h1>Ranking Final</h1>
  <table>
    <thead>
      <tr><th>Nome</th><th>Pontos</th><th>Tempo</th></tr>
    </thead>
    <tbody id="tabelaRankingFinal"></tbody>
  </table>
</div>

<!-- ========================= PÃ“DIO (VISÃVEL A TODOS, SEM RANKING) ========================== -->
<div id="podiumScreen" class="tela hidden">
  <h1>Resultado Final</h1>
  <div id="podium"></div>
</div>

<script>
// ================================================================
// ====================== CONFIG ================================
// ================================================================
const SCRIPT_URL = "COLE_AQUI_O_URL_DO_WORKER";
let isAdmin = false;
let nomeAtual = "";
let listaJogadores = [];
let indexPergunta = 0;
let ultimaPerguntaVista = 0;
let jogoFinalizado = false;

// ================================================================
// ======================== ENTRAR ===============================
// ================================================================
function entrar(){
  nomeAtual = document.getElementById("nomeInput").value.trim();
  isAdmin = document.getElementById("adminCheck").checked;

  if(!nomeAtual){
    alert("Digite seu nome");
    return;
  }

  if(!isAdmin){
    let local = JSON.parse(localStorage.getItem("quizPlayers") || "[]");
    if(!local.includes(nomeAtual)){
      local.push(nomeAtual);
      localStorage.setItem("quizPlayers", JSON.stringify(local));
    }
  }

  postEstado({ addPlayer: nomeAtual });

  hideAll();
  show(isAdmin ? "adminScreen" : "waitingScreen");
}

// ================================================================
// ==================== CONTROLES DO ADMIN ========================
// ================================================================
function iniciarQuiz(){
  indexPergunta = 0;
  jogoFinalizado = false;
  postEstado({ status: "rodando", pergunta_atual: indexPergunta });
}

function proxPergunta(){
  if (jogoFinalizado) return;
  indexPergunta++;
  postEstado({ pergunta_atual: indexPergunta });
}

async function resetTotal(){
  if (!isAdmin) return;

  if (!confirm("RESET TOTAL?\nIsso apagarÃ¡ jogadores, ranking e estado.")) return;

  await postEstado({ resetAll: true });

  localStorage.removeItem("quizPlayers");
  listaJogadores = [];
  jogoFinalizado = false;
  indexPergunta = 0;
  ultimaPerguntaVista = 0;

  hideAll();
  show("cadastroScreen");
}

// ================================================================
// ========================= JOGO ================================
// ================================================================
function exibirPerguntaAtual(estado){
  if (jogoFinalizado) return;
  if (!estado) return;

  indexPergunta = estado.pergunta_atual;

  // evita piscar no jogador
  if (!isAdmin && ultimaPerguntaVista === indexPergunta + 1) return;

  ultimaPerguntaVista = indexPergunta + 1;

  hideAll();
  show("quizScreen");

  const pergunta = perguntas[indexPergunta];
  if (!pergunta){
    finalGeral(estado);
    return;
  }

  document.getElementById("textoPergunta").innerText = pergunta.q;

  let o = "";
  pergunta.op.forEach((t,i)=>{
    o += `<button onclick="responder(${i})">${t}</button><br><br>`;
  });

  document.getElementById("opcoes").innerHTML = o;
}

function responder(op){
  const pergunta = perguntas[indexPergunta];
  const acertou = (op === pergunta.correta);
  const tempo = Math.random()*2+1; // simulaÃ§Ã£o â€” substitua por tempo real se quiser

  let local = JSON.parse(localStorage.getItem("quizPlayers") || "[]");

  let p = local.find(x => x.nome == nomeAtual);
  if (!p){
    p = { nome: nomeAtual, pontos: 0, tempoTotal: 0 };
    local.push(p);
  }

  if (acertou) p.pontos++;
  p.tempoTotal += tempo;

  localStorage.setItem("quizPlayers", JSON.stringify(local));

  hideAll();
  show("waitingScreen");
}

// ================================================================
// ======================== FINAL ================================
// ================================================================
function finalGeral(estado){
  jogoFinalizado = true;

  hideAll();

  // ==== Jogador vÃª apenas o pÃ³dio ====
  const podium = estado.top3;
  let html = "";

  podium.forEach((p,i)=>{
    html += `<div>${i+1}Âº - ${p.nome} (${p.pontos} pts)</div>`;
  });

  document.getElementById("podium").innerHTML = html;
  show("podiumScreen");

  // ==== Admin vÃª ranking completo ====
  if (isAdmin){
    let rank = estado.ranking;
    let html2 = "";
    rank.forEach(r=>{
      html2 += `<tr><td>${r.nome}</td><td>${r.pontos}</td><td>${r.tempoTotal}</td></tr>`;
    });
    document.getElementById("tabelaRankingFinal").innerHTML = html2;
    show("rankingAdmin");
  }
}

// ================================================================
// ======================== WORKER ===============================
// ================================================================
async function postEstado(data){
  try{
    await fetch(SCRIPT_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(data)
    });
  } catch (e){}
}

async function buscarEstadoServidor(){
  try{
    const r = await fetch(SCRIPT_URL);
    const estado = await r.json();

    // ADMIN: atualiza painel
    if (isAdmin){
      document.getElementById("statusAdmin").innerText = estado.status;
      document.getElementById("perguntaAtualAdmin").innerText = estado.pergunta_atual;
      document.getElementById("totalJogadoresAdmin").innerText = estado.total_jogadores;
    }

    if (!isAdmin){
      // jogador nunca vÃª o total de jogadores
      document.getElementById("contadorPessoas").classList.add("hidden");
    }

    if (estado.status === "final"){
      finalGeral(estado);
      return;
    }

    if (estado.status === "rodando"){
      exibirPerguntaAtual(estado);
      return;
    }
  } catch(e){}
}
setInterval(buscarEstadoServidor, 700);

// ================================================================
// ======================= INTERFACE ==============================
// ================================================================
function hide(id){ document.getElementById(id).style.display = "none"; }
function show(id){ document.getElementById(id).style.display = "block"; }
function hideAll(){
  document.querySelectorAll(".tela").forEach(t => t.style.display = "none");
}

// ================================================================
// ============== PERGUNTAS (EXEMPLO â€” EDITE SE QUISER) ===========
// ================================================================
const perguntas = [
  { q:"Capital de MG?", op:["Sete Lagoas","BH"], correta:1 },
  { q:"Maior estado do Brasil?", op:["SP","AM","MG"], correta:1 },
  { q:"2+2?", op:["3","4"], correta:1 }
];

</script>
</body>
</html>

